<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet"><title>Mastering code splitting with webpack</title><link rel="canonical" href="https://dielduarte.dev/blog/en/mastering-code-splitting-with-webpack/"><meta name="description" content="let's talk about how Webpack can help us to code splitting and achieve the goal of better website performance."><meta name="robots" content="index, follow"><meta property="og:title" content="Mastering code splitting with webpack"><meta property="og:type" content="article"><meta property="og:image" content="https://dielduarte.dev/images/en-mastering-code-splitting-with-webpack.png"><meta property="og:url" content="https://dielduarte.dev/blog/en/mastering-code-splitting-with-webpack/"><meta content="https://dielduarte.dev/images/en-mastering-code-splitting-with-webpack.png" name="twitter:image"><meta content="Mastering code splitting with webpack" name="twitter:title"><meta content="@diel_duarte" name="twitter:site"><meta content="summary_large_image" name="twitter:card"><meta content="let's talk about how Webpack can help us to code splitting and achieve the goal of better website performance." name="twitter:description"><link rel="stylesheet" href="/lang.7b5abac6.css" />
<style type="text/css">html{scroll-behavior:smooth}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.noise-overlay:before{content:"";position:fixed;top:0;left:0;width:100%;height:100%;opacity:.025;pointer-events:none;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");z-index:100}.prose-article{font-family:Crimson Pro,Georgia,serif;font-size:1.25rem;line-height:1.75;color:#3d3d3b}@media (prefers-color-scheme: dark){.prose-article{color:#e0e0e0}}.prose-article p{margin:1.75rem 0}.prose-article strong{color:#1f1f1d;font-weight:600}@media (prefers-color-scheme: dark){.prose-article strong{color:#fafaf8}}.prose-article a{color:#7d6e5e;text-decoration:none;background-image:linear-gradient(currentColor,currentColor);background-size:0% 1px;background-position:0 100%;background-repeat:no-repeat;transition:background-size .3s ease}@media (prefers-color-scheme: dark){.prose-article a{color:#b8a99a}}.prose-article a:hover{background-size:100% 1px}.prose-article h2{font-family:Plus Jakarta Sans,sans-serif;font-size:1.75rem;font-weight:700;color:#171715;margin:3rem 0 1.5rem;letter-spacing:-.02em}@media (prefers-color-scheme: dark){.prose-article h2{color:#fafaf8}}.prose-article h3{font-family:Plus Jakarta Sans,sans-serif;font-size:1.375rem;font-weight:600;color:#1f1f1d;margin:2.5rem 0 1rem}@media (prefers-color-scheme: dark){.prose-article h3{color:#f5f5f2}}.prose-article h4{font-family:Plus Jakarta Sans,sans-serif;font-size:1.125rem;font-weight:600;color:#1f1f1d;margin:2rem 0 .75rem}@media (prefers-color-scheme: dark){.prose-article h4{color:#f5f5f2}}.prose-article pre{font-family:JetBrains Mono,monospace;font-size:.9rem;padding:1.5rem;border-radius:8px;margin:2rem 0;overflow-x:auto;background:#171715!important;border:1px solid #2A2A28}.prose-article code{font-family:JetBrains Mono,monospace;font-size:.875em}.prose-article :not(pre)>code{background:rgba(125,110,94,.1);color:#635850;padding:.2em .4em;border-radius:4px}@media (prefers-color-scheme: dark){.prose-article :not(pre)>code{background:rgba(184,169,154,.15);color:#b8a99a}}.prose-article ul,.prose-article ol{margin:1.5rem 0;padding-left:0;list-style:none}.prose-article ul li,.prose-article ol li{position:relative;padding-left:1.75rem;margin-bottom:.75rem}.prose-article ul li:before{content:"";position:absolute;left:0;top:.75em;width:5px;height:5px;background:#7D6E5E;border-radius:50%}@media (prefers-color-scheme: dark){.prose-article ul li:before{background:#9A8B7A}}.prose-article ol{counter-reset:list-counter}.prose-article ol li{counter-increment:list-counter}.prose-article ol li:before{content:counter(list-counter);position:absolute;left:0;font-family:Plus Jakarta Sans,sans-serif;font-weight:600;font-size:.875rem;color:#7d6e5e}@media (prefers-color-scheme: dark){.prose-article ol li:before{color:#9a8b7a}}.prose-article blockquote{margin:2.5rem 0;padding:1.5rem 2rem;background:rgba(125,110,94,.05);border-left:3px solid #9A8B7A;border-radius:0 8px 8px 0;font-style:italic}@media (prefers-color-scheme: dark){.prose-article blockquote{background:rgba(184,169,154,.05);border-left-color:#7d6e5e}}.prose-article blockquote p{margin:0;color:#5c5c5a}@media (prefers-color-scheme: dark){.prose-article blockquote p{color:#b8b8b5}}.prose-article img,.prose-article video{max-width:100%;border-radius:8px;margin:2.5rem auto;display:block}.prose-article hr{border:none;height:1px;background:linear-gradient(90deg,transparent,#DCDCD7,transparent);margin:3rem 0}@media (prefers-color-scheme: dark){.prose-article hr{background:linear-gradient(90deg,transparent,#2A2A28,transparent)}}.reading-progress{position:fixed;top:0;left:0;height:2px;background:#7D6E5E;z-index:1000;transition:width .1s ease-out}@media (prefers-color-scheme: dark){.reading-progress{background:#9A8B7A}}
</style><script type="module" src="/_astro/hoisted.00e308b0.js"></script></head><body class="noise-overlay bg-ivory-100 dark:bg-ink-900 min-h-screen transition-colors duration-300"><!-- Reading progress bar --><div class="reading-progress" id="progress-bar" style="width: 0%"></div><div class="max-w-3xl mx-auto px-6 md:px-8 py-12 md:py-20"><!-- Back navigation --><nav class="mb-12"><a href="/" class="inline-flex items-center gap-2 text-sm text-ink-400 dark:text-ivory-400 hover:text-ink-700 dark:hover:text-ivory-100 transition-colors duration-200 group"><svg class="w-4 h-4 transform group-hover:-translate-x-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path></svg>Back to all articles</a></nav><!-- Article Header --><header class="mb-12 md:mb-16"><!-- Meta info --><div class="flex flex-wrap items-center gap-4 mb-6"><time datetime="2019-07-17" class="text-sm font-mono text-accent-500 dark:text-accent-400">July 16, 2019</time><span class="text-ink-300 dark:text-ink-600">·</span><span class="text-sm text-ink-400 dark:text-ivory-400 font-mono">5 min read</span></div><!-- Title --><h1 class="text-3xl md:text-4xl lg:text-5xl font-display font-bold text-ink-800 dark:text-ivory-100 leading-tight tracking-tight mb-6">Mastering code splitting with webpack</h1><!-- Description --><p class="text-lg md:text-xl text-ink-500 dark:text-ivory-300 leading-relaxed">let&#39;s talk about how Webpack can help us to code splitting and achieve the goal of better website performance.</p><!-- Decorative divider --><div class="mt-10 flex items-center gap-3"><div class="w-12 h-px bg-accent-400 dark:bg-accent-500"></div><div class="w-1.5 h-1.5 bg-accent-400 dark:bg-accent-500 rounded-full"></div></div></header><!-- Article Content --><article class="prose-article"><p>code splitting is a build time process that splits pieces of your code into async chunks, let's talk about how Webpack can help us to code split and achieve the goal of better website performance.</p>
<h2 class="subtitle--separator">But first, How to know when I have to split my code?</h2>
<p>The most expensive part of rendering websites is about downloading, and parsing  Javascript and css. That said, if we don't need to render a specific piece of code on the first render, this code is a good candidate to split and be downloaded by demand, no secrets so far.</p>
<p>Google Chrome has a nice dev tool called <code>coverage</code> that shows what percentage of the code delivered it's being used. This might be used as a metric to follow and know how much code might be split and downloaded by demand.</p>
<p>To use the coverage tool just open your dev tools, <code>cmd/ctrl + p</code>, and type <code>show coverage</code>:</p>
<p><img src="/images/coverage.png" alt="image showing how to access coverage tab on chrome dev tools"></p>
<p>then, on the coverage tab click on the reload button and wait until the website is reloaded, this will show you how much code you are using on that specific page per asset downloaded. It's AMAZING! </p>
<p><img src="/images/result.png" alt="image showing coverage tab, where we can see a list of assets downloaded and how much code is not being used in red."></p>
<p>In the example above, 46% of the code delivered is <code>not</code> being used! but that metric is also relative, depends on file size and many other variables, so the context/scenario is super important when using these tools.</p>
<h2 id="code-splitting-and-webpack">Code splitting and webpack</h2>
<p>With webpack we have two ways to work with code splitting, static and "dynamic" imports, both using <a href="https://v8.dev/features/dynamic-import">dynamic imports es2020 feature</a></p>
<h3 id="static-import">Static import</h3>
<ul>
<li>Good to use when importing heavy javascript libraries/modules</li>
<li>Anything temporal - things that aren't visible all the time on your page, tooltip, modal/dialog and even the rest of the page that comes only on scroll could be considered temporal</li>
<li>Routes</li>
</ul>
<p>To use static imports on your code just do:</p>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #81A1C1">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">path/to/myModule.js</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF">)</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">.</span><span style="color: #88C0D0">then</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">module</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=></span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span><span style="color: #81A1C1">...</span><span style="color: #ECEFF4">}</span><span style="color: #D8DEE9FF">)</span></span></code></pre>
<p>Or, even better, making a function to import the module when necessary, the import of the file itself is made just one time, then is cached and the next time calling the function the module is returned instantly, e.g:</p>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #81A1C1">const</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">getModule</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> () ⇒ </span><span style="color: #81A1C1">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">path/to/myModule.js</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">getModule</span><span style="color: #D8DEE9FF">()</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">.</span><span style="color: #88C0D0">then</span><span style="color: #D8DEE9FF">(</span><span style="color: #D8DEE9">module</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=></span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span><span style="color: #81A1C1">...</span><span style="color: #ECEFF4">}</span><span style="color: #D8DEE9FF">)</span></span></code></pre>
<h3 id="dynamic-import">Dynamic import</h3>
<p>"Dynamic" imports aren't really dynamic since they are made at build time. Using dynamic imports it's like saying to Webpack: Hey Webpack, please do all possibilities of chunks in this specific path at build time. So in this way, we can pass the chunk file that we wanna import using variables which makes this process kinda dynamic.</p>
<p>Considering we have a folder of themes like:</p>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #D8DEE9">themes</span></span>
<span class="line"><span style="color: #D8DEE9FF">  └── </span><span style="color: #D8DEE9">dark</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">js</span></span>
<span class="line"><span style="color: #D8DEE9FF">  └── </span><span style="color: #D8DEE9">light</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">js</span></span></code></pre>
<p>As an example we can do like:</p>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #81A1C1">const</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">getTheme</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> (</span><span style="color: #D8DEE9">theme</span><span style="color: #D8DEE9FF">) ⇒ </span><span style="color: #81A1C1">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">`</span><span style="color: #A3BE8C">path/to/themes/</span><span style="color: #81A1C1">${</span><span style="color: #D8DEE9">theme</span><span style="color: #81A1C1">}</span><span style="color: #ECEFF4">`</span><span style="color: #D8DEE9FF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">getTheme</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">dark</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF">)</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">.</span><span style="color: #88C0D0">then</span><span style="color: #D8DEE9FF">(</span><span style="color: #D8DEE9">theme</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=></span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span><span style="color: #81A1C1">...</span><span style="color: #ECEFF4">}</span><span style="color: #D8DEE9FF">)</span></span></code></pre>
<p>This way webpack will create chunks for each theme file inside the themes folder, this technique is called <code>ContextModule</code> into webpack code.</p>
<h2 id="magic-comments">Magic comments</h2>
<h3 id="webpackchunkname">webpackChunkName</h3>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #88C0D0">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #616E88">/* webpackChunkName: "my-chunk-name" */</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">path/to/myModule.js</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF">)</span></span></code></pre>
<p>By default webpack creates chunk names following a numeral order, 1.js, 2.js, 3.js which makes the process of debugging harder to recognize which file was imported. using <code>webpackChunkName</code> we can rename the chunk file, it's important to remember that for this magic comment work we should be using the config <code>output.chunkFileName: [name].whateverDoYouWantHere.js</code> on webpack.config file.</p>
<p>this is only helpful on dev mode, so we can do like:</p>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF">(</span><span style="color: #D8DEE9">process</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">NODE_ENV</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">===</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">development</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF">) </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #616E88">/* webpackChunkName: "my-chunk-name" */</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">path/to/myModule.js</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF">)</span></span>
<span class="line"><span style="color: #ECEFF4">}</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">else</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #ECEFF4">'</span><span style="color: #A3BE8C">path/to/myModule.js</span><span style="color: #ECEFF4">'</span><span style="color: #D8DEE9FF">)</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<p>The <code>if</code> part will be removed if the build is running in production mode, and the <code>else</code> part if in dev mode. This is known as dead-code elimination, tools like Uglify.js and others do that to reduce bundle size.</p>
<h3 id="webpackmode">webpackMode</h3>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #88C0D0">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #616E88">/* webpackMode: "lazy" */</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">`</span><span style="color: #A3BE8C">path/to/themes/</span><span style="color: #81A1C1">${</span><span style="color: #D8DEE9">theme</span><span style="color: #81A1C1">}</span><span style="color: #ECEFF4">`</span><span style="color: #D8DEE9FF">)</span></span></code></pre>
<p>the magic comment webpackMode has four types of value:</p>
<ul>
<li>lazy: generate chunks for each dynamic imported module, perfect choice to be used in production mode.</li>
<li>lazy-once: generate a single chunk that can satisfy all calls to import statement, perfect  choice to dev mode reducing the "bundling" time.</li>
<li>eager: generates no extra chunk, all modules are included in the current chunk and no additional network requests are made.</li>
<li>weak: this is useful for universal rendering when required chunks are always manually served in initial requests, a Promise is still returned, but only successfully resolves if the chunks are already with the client. If the module is not available, the Promise is rejected. A network request will never be performed</li>
</ul>
<h3 id="prefetch-and-preload">Prefetch and Preload</h3>
<pre is:raw="" class="astro-code nord" style="background-color: #2e3440ff; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #88C0D0">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #616E88">/* webpackPrefetch: true */</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">`</span><span style="color: #A3BE8C">path/to/themes/</span><span style="color: #81A1C1">${</span><span style="color: #D8DEE9">theme</span><span style="color: #81A1C1">}</span><span style="color: #ECEFF4">`</span><span style="color: #D8DEE9FF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">import</span><span style="color: #D8DEE9FF">(</span><span style="color: #616E88">/* webpackLoad: true */</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">`</span><span style="color: #A3BE8C">path/to/themes/</span><span style="color: #81A1C1">${</span><span style="color: #D8DEE9">theme</span><span style="color: #81A1C1">}</span><span style="color: #ECEFF4">`</span><span style="color: #D8DEE9FF">)</span></span></code></pre>
<p>both comments above will create a link tag with <code>rel=prefetch</code> or <code>rel=preload</code> automatically for you, prefetching or preloading your chunks depends on the situation. if you don't know what prefetch and preload links do, I highly recommend you to read that post <a href="https://medium.com/reloading/preload-prefetch-and-priorities-in-chrome-776165961bbf">Preload, Prefetch And Priorities in Chrome</a>.</p>
<p>This were my notes of <a href="https://frontendmasters.com/courses/performance-webpack/">Web performance with webpack</a> course, I hope you have learned something new today, see you next time! ❤️</p></article><!-- Article Footer --><footer class="mt-16 pt-10 border-t border-ivory-300 dark:border-ink-700"><!-- Author card --><div class="flex items-center gap-5 mb-10"><div class="relative"><div class="absolute -inset-0.5 bg-gradient-to-br from-accent-400 to-accent-600 dark:from-accent-500 dark:to-accent-700 rounded-full opacity-50 blur-sm"></div><img src="/images/diel.jpeg" alt="Diel Duarte" class="relative w-14 h-14 rounded-full object-cover ring-2 ring-ivory-100 dark:ring-ink-900"></div><div><p class="font-display font-semibold text-ink-800 dark:text-ivory-100">Diel Duarte</p><p class="text-sm text-ink-400 dark:text-ivory-400">Principal Engineer at Appcues</p></div></div><!-- Back to home --><a href="/" class="inline-flex items-center gap-3 px-5 py-2.5 border border-ink-200 dark:border-ink-700 text-ink-600 dark:text-ivory-300 hover:bg-ink-800 hover:text-ivory-100 dark:hover:bg-ivory-100 dark:hover:text-ink-800 rounded-lg transition-colors duration-200 text-sm font-medium"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path></svg>Back to all articles</a></footer></div></body></html>