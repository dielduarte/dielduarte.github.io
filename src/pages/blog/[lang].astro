---
import { format } from 'date-fns';

interface Frontmatter {
  title: string;
  description: string;
	date: string;
	languageKey: string;
	languageLink: string;
	socialImage: string;
	slug: string
}

export async function getStaticPaths() {
  const enPosts = await Astro.glob<Frontmatter>('./en/**/*.md')
  const ptBrPosts = await Astro.glob<Frontmatter>('./pt-br/**/*.md')
  
  return [
    {params: {lang: 'en'}, props: {posts: enPosts, lang: 'en'}},
    {params: {lang: 'pt-br'}, props: {posts: ptBrPosts, lang: 'pt-br'}},
  ];
}

const { posts, lang } = Astro.props;

const sortedPosts = [...posts].sort((prevPost, nextPost) => {
  return new Date(nextPost.frontmatter.date).getTime() > new Date(prevPost.frontmatter.date).getTime() 
    ? 1 
    : -1;
})

const menuItems = [
  { label: 'GITHUB', href: 'https://github.com/dielduarte', external: true },
  { label: 'LINKEDIN', href: 'https://www.linkedin.com/in/dielduarte/', external: true },
  { label: 'TWITTER', href: 'https://twitter.com/diel_duarte', external: true },
  { label: 'EMAIL', href: 'mailto:magdiel.kesller@gmail.com', external: false },
];

const isEnglish = lang === 'en';
---

<html lang={lang}>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Diel Duarte | Software Engineer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto&display=swap" rel="stylesheet">
  
  <style>
    /* CRT Scanline Effect - requires repeating gradient */
    .scanlines {
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.15) 0px,
        rgba(0, 0, 0, 0.15) 1px,
        transparent 1px,
        transparent 2px
      );
    }

    /* Pixel frame - complex box-shadow */
    .pixel-frame {
      box-shadow: 
        inset 0 0 0 2px #181818,
        inset 0 0 0 4px #3a3a3a,
        8px 8px 0 0 rgba(0, 0, 0, 0.3);
    }

    .pixel-frame::before {
      content: '';
      @apply absolute inset-0 pointer-events-none;
      box-shadow: inset 0 0 60px rgba(94, 182, 174, 0.1);
    }

    /* Avatar - complex box-shadow */
    .avatar-container {
      image-rendering: pixelated;
      box-shadow: 
        0 0 0 3px #181818,
        0 0 0 6px #5eb6ae,
        6px 6px 0 0 rgba(0, 0, 0, 0.4);
    }

    /* Glow effects - text-shadow not in Tailwind */
    .glow-orange { text-shadow: 0 0 8px rgb(215, 136, 56); }
    .glow-teal { text-shadow: 0 0 8px #5eb6ae; }

    /* Scrollbar styling - browser-specific */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { @apply bg-game-dark; }
    ::-webkit-scrollbar-thumb { @apply bg-game-border border border-game-teal; }
    ::-webkit-scrollbar-thumb:hover { @apply bg-game-teal; }
  </style>
</head>

<body class="bg-game-dark text-game-text font-pressStart min-h-screen flex items-center justify-center p-4 md:p-8">
  <!-- Scanline overlay -->
  <div class="scanlines fixed inset-0 z-50 pointer-events-none" aria-hidden="true"></div>

  <!-- Main game frame -->
  <main class="pixel-frame bg-game-dark w-full max-w-4xl p-6 md:p-10 relative border-4 border-game-text">
    
    <!-- Header: Avatar + Title -->
    <header class="flex flex-col md:flex-row items-center gap-6 md:gap-8 mb-10 md:mb-12">
      <!-- Avatar -->
      <div class="avatar-container rounded-sm overflow-hidden flex-shrink-0 animate-float border-[3px] border-game-orange">
        <img 
          src="/images/diel.jpeg" 
          alt="Diel Duarte" 
          class="w-24 h-24 md:w-28 md:h-28 object-cover"
        />
      </div>

      <!-- Title section -->
      <div class="text-center md:text-left">
        <h1 class="text-lg md:text-xl text-game-orange mb-3 leading-relaxed">
          DIEL DUARTE
        </h1>
        <p class="text-xs md:text-sm text-game-teal mb-2">
          SOFTWARE ENGINEER
        </p>
        <p class="text-[10px] text-game-text opacity-60 leading-relaxed">
          {isEnglish ? 'Building things for the web' : 'Construindo coisas para a web'}
        </p>
      </div>
    </header>

    <!-- About Section -->
    <section class="mb-10 md:mb-12" aria-label="About">
      <h2 class="text-xs text-game-text opacity-50 mb-4 tracking-wider">
        {isEnglish ? '[ ABOUT ]' : '[ SOBRE ]'}
      </h2>
      <div class="font-roboto text-sm leading-relaxed text-game-text space-y-3">
        <p>
          {isEnglish 
            ? 'Principal Engineer at Appcues, where I help shape developer experience and frontend architecture. Previously led teams building web and mobile products across multiple companies.'
            : 'Principal Engineer na Appcues, onde ajudo a moldar a experiência do desenvolvedor e arquitetura frontend. Anteriormente liderei times construindo produtos web e mobile em diversas empresas.'}
        </p>
        <p>
          {isEnglish
            ? 'Over 10 years of experience building high-impact web applications and leading engineering teams. From architecture decisions to shipping production code, I help teams move faster by improving developer experience.'
            : 'Mais de 10 anos de experiência construindo aplicações web de alto impacto e liderando times de engenharia. De decisões de arquitetura a código em produção, ajudo times a serem mais produtivos melhorando a experiência do desenvolvedor.'}
        </p>
      </div>
    </section>

    <!-- Navigation Menu -->
    <nav class="mb-10 md:mb-12" aria-label="Social links">
      <h2 class="text-xs text-game-text opacity-50 mb-4 tracking-wider">
        {isEnglish ? '[ CONNECT ]' : '[ CONECTAR ]'}
      </h2>
      <ul class="flex flex-col gap-3 text-xs md:text-sm">
        {menuItems.map((item) => (
          <li>
            <a 
              href={item.href}
              target={item.external ? '_blank' : undefined}
              rel={item.external ? 'noopener noreferrer' : undefined}
              class="nav-item group inline-flex items-center gap-2 transition-all duration-150 outline-none focus:outline-none hover:text-game-orange focus:text-game-orange hover:glow-orange focus:glow-orange"
              aria-label={`${item.external ? 'Visit my ' : ''}${item.label.toLowerCase()}`}
            >
              <span class="text-game-orange opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-150" aria-hidden="true">&gt;</span>
              <span>{item.label}</span>
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <!-- Blog Posts Section -->
    <section aria-label="Blog posts">
      <div class="flex items-center gap-4 mb-6">
        <h2 class="text-xs text-game-text opacity-50 tracking-wider">
          {isEnglish ? '[ BLOG POSTS ]' : '[ ARTIGOS ]'}
        </h2>
        <div class="flex-1 h-px bg-game-border opacity-50"></div>
        <span class="text-[10px] text-game-teal">
          {sortedPosts.length}&nbsp;{isEnglish ? 'ENTRIES' : 'ENTRADAS'}
        </span>
      </div>

      <nav class="flex flex-col gap-3 max-h-[40vh] overflow-y-auto pr-2" aria-label="Blog posts list">
        {sortedPosts.map((post, index) => (
          <a 
            href={`/blog/${post.frontmatter.slug}/`} 
            class="nav-item group flex items-baseline gap-2 text-xs transition-all duration-150 outline-none focus:outline-none hover:text-game-teal focus:text-game-teal"
          >
            <span class="text-game-teal opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-150 flex-shrink-0" aria-hidden="true">&gt;</span>
            <span class="flex flex-col md:flex-row md:items-baseline gap-1 md:gap-4">
              <span class="text-game-text opacity-40 font-roboto text-[10px] md:text-xs whitespace-nowrap">
                {format(new Date(post.frontmatter.date), 'yyyy.MM.dd')}
              </span>
              <span class="text-game-text group-hover:text-game-teal group-focus:text-game-teal group-hover:glow-teal group-focus:glow-teal transition-colors leading-relaxed">
                {post.frontmatter.title}
              </span>
            </span>
          </a>
        ))}
      </nav>
    </section>

    <!-- Footer: Language Switcher & Hint -->
    <footer class="mt-10 md:mt-12 pt-6 border-t border-game-border">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <!-- Language switcher -->
        <div class="flex items-center gap-2 text-[10px]">
          <span class="text-game-text opacity-50">LANG:</span>
          <a 
            href="/blog/en" 
            class:list={[
              "transition-all duration-150 hover:text-game-orange focus:text-game-orange focus:outline-none hover:glow-orange focus:glow-orange",
              { "text-game-orange underline underline-offset-4 glow-orange": isEnglish }
            ]}
            aria-label="Switch to English"
          >
            EN
          </a>
          <span class="text-game-border">|</span>
          <a 
            href="/blog/pt-br" 
            class:list={[
              "transition-all duration-150 hover:text-game-orange focus:text-game-orange focus:outline-none hover:glow-orange focus:glow-orange",
              { "text-game-orange underline underline-offset-4 glow-orange": !isEnglish }
            ]}
            aria-label="Switch to Portuguese"
          >
            PT-BR
          </a>
        </div>

        <!-- Hint text -->
        <p class="text-[10px] text-game-text opacity-40 animate-blink-slow">
          {isEnglish ? '[ HOVER TO SELECT ]' : '[ PASSE O MOUSE PARA SELECIONAR ]'}
        </p>
      </div>
    </footer>
  </main>

  <script>
    // Keyboard navigation for menu and blog posts
    document.addEventListener('DOMContentLoaded', () => {
      const navItems = Array.from(document.querySelectorAll('.nav-item'));
      let currentIndex = -1;

      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
          e.preventDefault();
          
          if (e.key === 'ArrowDown') {
            currentIndex = currentIndex < navItems.length - 1 ? currentIndex + 1 : 0;
          } else {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : navItems.length - 1;
          }
          
          navItems[currentIndex].focus();
        } else if (e.key === 'Enter' && currentIndex >= 0) {
          navItems[currentIndex].click();
        }
      });

      // Update currentIndex when user focuses an item with tab or mouse
      navItems.forEach((item, index) => {
        item.addEventListener('focus', () => {
          currentIndex = index;
        });
      });
    });
  </script>
</body>
</html>
